<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="xela">

  <!-- Rviz colors -->
  <material name="black">
    <color rgba="0.1 0.1 0.1 1.0"/>
  </material>

  <material name="blue">
    <color rgba="0.0 0.0 0.8 1.0"/>
  </material>

  <material name="green">
    <color rgba="0.0 0.8 0.0 1.0"/>
  </material>

  <material name="grey">
    <color rgba="0.2 0.2 0.2 1.0"/>
  </material>

  <material name="orange">
    <color rgba="${255/255} ${108/255} ${10/255} 1.0"/>
  </material>

  <material name="brown">
    <color rgba="${222/255} ${207/255} ${195/255} 1.0"/>
  </material>

  <material name="red">
    <color rgba="0.8 0.0 0.0 1.0"/>
  </material>

  <material name="white">
    <color rgba="1.0 1.0 1.0 1.0"/>
  </material>

  <!-- Taxels -->
  <xacro:macro name="taxel" params="sequence parent x:=0.0 y:=0.0 z:=0.0 rx:=0.0 ry:=0.0 rz:=0.0 col:='blue' zmod:=0.0">
    <link name="${sequence}_taxel_base_link">
      <visual>
        <geometry>
          <sphere radius="0.001"/>
        </geometry>
        <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
        <material name="${col}"/>
      </visual>
      <collision>
        <geometry>
          <sphere radius="0.001"/>
        </geometry>
      </collision>
    </link>

    <link name="${sequence}_base2x">
      <visual>
        <geometry>
          <sphere radius="0.0001"/>
        </geometry> 
        <origin xyz="${x} ${y} ${z}" rpy="0 0 0"/>
        <material name="${col}"/>
      </visual> 
      <collision>
        <geometry>
          <sphere radius="0.0001"/>
        </geometry>
      </collision>
    </link>

    <link name="${sequence}_x2y">
      <visual>
        <geometry>
          <sphere radius="0.0001"/>
        </geometry> 
        <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
        <material name="${col}"/>
      </visual> 
      <collision>
        <geometry>
          <sphere radius="0.0001"/>
        </geometry>
      </collision>
    </link>

    <joint name="${sequence}_joint_x" type="prismatic">
      <origin xyz="${x} ${y} ${z}" rpy="${radians(rx)} ${radians(ry)} ${radians(rz)}"/>
      <parent link="${parent}"/>
      <child link="${sequence}_base2x"/>
      <axis xyz="1 0 0"/>
      <limit effort="100.0" lower="-0.0015" upper="0.0015" velocity="0.5"/>
    </joint>
    <joint name="${sequence}_joint_y" type="prismatic">
      <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
      <parent link="${sequence}_base2x"/>
      <child link="${sequence}_x2y"/>
      <axis xyz="0 1 0"/>
      <limit effort="100.0" lower="-0.0015" upper="0.0015" velocity="0.5"/>
    </joint>
    <joint name="${sequence}_joint_z" type="prismatic">
      <origin xyz="0.0 0.0 ${zmod}" rpy="0.0 0.0 0.0"/>
      <parent link="${sequence}_x2y"/>
      <child link="${sequence}_taxel_base_link"/>
      <axis xyz="0 0 1"/>
      <limit effort="100.0" lower="${-0.001-zmod}" upper="0.000" velocity="0.5"/>
    </joint>
  </xacro:macro>

  <!-- Test taxel (shows both max and min Z position). Useful for new sensor development -->
  <xacro:macro name="taxeltest" params="sequence parent x:=0.0 y:=0.0 z:=0.0 rx:=0.0 ry:=0.0 rz:=0.0">
    <xacro:taxel sequence="${sequence}A"  x="${x}" y="${y}" z="${z}" rx="${rx}" ry="${ry}" rz="${rz}" parent="${parent}" />
    <xacro:taxel sequence="${sequence}B"  x="${x}" y="${y}" z="${z}" rx="${rx}" ry="${ry}" rz="${rz}" parent="${parent}" col="red" zmod="-0.001" />
  </xacro:macro>

  <!-- Sensors -->
  <xacro:macro name="sensoraftf" params="sequence parent x:=0.0 y:=0.0 z:=0.0 rx:=0.0 ry:=0.0 rz:=0.0 col:='blue' taxels:=0 skipinertia:=0">
    <joint name="${sequence}_aftf_fixed" type="fixed">
      <origin xyz="${x} ${y} ${z}" rpy="${radians(rx)} ${radians(ry)} ${radians(rz)}"/>
      <parent link="${parent}" />
      <child link="${sequence}_aftf_base_link" />
    </joint>
    <link name="${sequence}_aftf_base_link">
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://xela_models/mesh/ft_f.stl"/>
        </geometry>
      </collision>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://xela_models/mesh/ft_f.stl"/>
        </geometry>
        <material name="${col}"/>
      </visual>
      <xacro:if value="${skipinertia == 0}">
        <inertial>
          <mass value="0.0142" />
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <inertia ixx="3.45e-07" ixy="0.0" ixz="0.0" iyy="3.32e-07" iyz="1.14e-08" izz="3.88e-07" />
        </inertial>
      </xacro:if>
      
    </link>

    <link name="${sequence}_aftf_sensorbase_base_link">
      <visual>
        <geometry>
          <sphere radius="0.001"/>
        </geometry>
        <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
        <material name="black" />
      </visual>
      <collision>
        <geometry>
          <sphere radius="0.001"/>
        </geometry>
      </collision>
    </link>
    <link name="${sequence}_aftf_sensorbase_pos_link">
      <visual>
        <geometry>
          <sphere radius="0.00001"/>
        </geometry>
        <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
        <material name="black" />
      </visual>
      <collision>
        <geometry>
          <sphere radius="0.00001"/>
        </geometry>
      </collision>
    </link>
    <joint name="${sequence}_aftf_sensor_pos_joint" type="prismatic">
      <origin xyz="0.0 0.0140 0.0010" rpy="${radians(-25)} 0.0 0.0"/>
      <parent link="${sequence}_aftf_base_link"/>
      <child link="${sequence}_aftf_sensorbase_pos_link"/>
      <axis xyz="0 0 1"/>
      <limit effort="100.0" lower="0.000" upper="0.000" velocity="0.5"/>
    </joint>
    <joint name="${sequence}_aftf_sensor_joint" type="prismatic">
      <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 ${radians(-90)}"/>
      <parent link="${sequence}_aftf_sensorbase_pos_link"/>
      <child link="${sequence}_aftf_sensorbase_base_link"/>
      <axis xyz="0 0 1"/>
      <limit effort="100.0" lower="0.000" upper="0.000" velocity="0.5"/>
    </joint>
    <xacro:if value="${taxels==1}">
      <xacro:sensor4x4 sequence="${sequence}_aftf" x="-0.0111665" y="-0.0116665" parent="${sequence}_aftf_sensorbase_base_link" body="0" />
    </xacro:if>
  </xacro:macro>

  <xacro:macro name="sensoraftc" params="sequence parent x:=0.0 y:=0.0 z:=0.0 rx:=0.0 ry:=0.0 rz:=0.0 col:='blue' taxels:=1 skipinertia:=0">
    <joint name="${sequence}_aftc_fixed" type="fixed">
      <origin xyz="${x-0.013} ${y} ${z}" rpy="${radians(rx)} ${radians(ry)} ${radians(rz)}"/>
      <parent link="${parent}" />
      <child link="${sequence}_aftc_base_link" />
    </joint>
    <link name="${sequence}_aftc_base_link">
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://xela_models/mesh/ft_c.stl"/>
        </geometry>
      </collision>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://xela_models/mesh/ft_c.stl"/>
        </geometry>
        <material name="${col}"/>
      </visual>
      <xacro:if value="${skipinertia == 0}">
        <inertial>
          <mass value="0.0266" />
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <inertia ixx="1.66e-06" ixy="0.0" ixz="0.0" iyy="1.23e-06" iyz="0.0" izz="1.70e-06" />
        </inertial>
      </xacro:if>
    </link>
    <xacro:if value="${taxels == 1}">
      <xacro:taxel sequence="${sequence}_aftc_1"  x="0.0101" y="0.0306" z="0.01254" ry="90" rz="30" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_2"  x="0.0126" y="0.0236" z="0.01254" ry="90" rz="10" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_3"  x="0.0138" y="0.0173" z="0.01254" ry="90" rz="10" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_4"  x="0.0143" y="0.0103" z="0.01254" ry="90" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_5"  x="0.0143" y="0.0038" z="0.01254" ry="90" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_6"  x="0.0098" y="0.0230" z="0.02000" ry="50" rz="10" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_7"  x="0.0110" y="0.0167" z="0.02000" ry="50" rz="10" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_8"  x="0.0115" y="0.0103" z="0.02000" ry="50" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_9"  x="0.0115" y="0.0038" z="0.02000" ry="50" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_10" x="0.0037" y="0.0338" z="0.01730" ry="29" rx="-48" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_11" x="0.0039" y="0.0296" z="0.02155" ry="26" rx="-31" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_12" x="0.0039" y="0.0230" z="0.02444" ry="22" rx="-10" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_13" x="0.0039" y="0.0169" z="0.02544" ry="21" rx="-10" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_14" x="0.0039" y="0.0103" z="0.02574" ry="18" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_15" x="0.0039" y="0.0038" z="0.02574" ry="18" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_16" x="-0.0037" y="0.0338" z="0.01730" ry="-29" rx="-48" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_17" x="-0.0039" y="0.0296" z="0.02155" ry="-26" rx="-31" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_18" x="-0.0039" y="0.0230" z="0.02444" ry="-22" rx="-10" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_19" x="-0.0039" y="0.0169" z="0.02544" ry="-21" rx="-10" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_20" x="-0.0039" y="0.0103" z="0.02574" ry="-18" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_21" x="-0.0039" y="0.0038" z="0.02574" ry="-18" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_22" x="-0.0098" y="0.0230" z="0.02000" ry="-50" rz="-10" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_23" x="-0.0110" y="0.0167" z="0.02000" ry="-50" rz="-10" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_24" x="-0.0115" y="0.0103" z="0.02000" ry="-50" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_25" x="-0.0115" y="0.0038" z="0.02000" ry="-50" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_26" x="-0.0101" y="0.0306" z="0.01254" ry="-90" rz="-30" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_27" x="-0.0126" y="0.0236" z="0.01254" ry="-90" rz="-10" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_28" x="-0.0138" y="0.0173" z="0.01254" ry="-90" rz="-10" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_29" x="-0.0143" y="0.0103" z="0.01254" ry="-90" parent="${sequence}_aftc_base_link" />
      <xacro:taxel sequence="${sequence}_aftc_30" x="-0.0143" y="0.0038" z="0.01254" ry="-90" parent="${sequence}_aftc_base_link" />
    </xacro:if>
  </xacro:macro>
   <xacro:macro name="aftd" params="sequence parent x:=0.0 y:=0.0 z:=0.0 rx:=0.0 ry:=0.0 rz:=0.0 col:='blue' skipinertia:=0">
    <joint name="${sequence}_aftd_fixed" type="fixed">
      <origin xyz="${x-0.013} ${y} ${z}" rpy="${radians(rx)} ${radians(ry)} ${radians(rz)}"/>
      <parent link="${parent}" />
      <child link="${sequence}_aftd_base_link" />
    </joint>
    <link name="${sequence}_aftd_base_link">
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://xela_models/mesh/allegro/ahft_default.STL"/>
        </geometry>
      </collision>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://xela_models/mesh/allegro/ahft_default.STL"/>
        </geometry>
        <material name="${col}"/>
      </visual>
      <xacro:if value="${skipinertia == 0}">
        <inertial>
          <mass value="0.0168" />
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <inertia ixx="1.63e-07" ixy="0.0" ixz="0.0" iyy="1.63e-07" iyz="0.0" izz="1.60e-07" />
        </inertial>
      </xacro:if>
    </link>
  </xacro:macro>
  <xacro:macro name="sensor4x4" params="sequence parent x:=0.0 y:=0.0 z:=0.0 rx:=0.0 ry:=0.0 rz:=0.0 col:='blue' body:=1 taxels:=1 skipinertia:=0">
    <joint name="${sequence}_4x4_fixed" type="fixed">
      <origin xyz="${x} ${y} ${z}" rpy="${radians(rx)} ${radians(ry)} ${radians(rz)}"/>
      <parent link="${parent}" />
      <child link="${sequence}_4x4_base_link" />
    </joint>
    <link name="${sequence}_4x4_base_link">
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://xela_models/mesh/4x4.stl"/>
        </geometry>
      </collision>
      <xacro:if value="${body == 1}">
        <visual>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <geometry>
            <mesh filename="package://xela_models/mesh/4x4.stl"/>
          </geometry>
          <material name="${col}"/>
        </visual>
        <xacro:unless value="${skipinertia == 1}">
          <inertial>
            <mass value="0.0036" />
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <inertia ixx="5.76e-09" ixy="0.0" ixz="0.0" iyy="6.55e-09" iyz="1.44e-10" izz="1.20e-08" />
          </inertial>
        </xacro:unless>
      </xacro:if>
    </link>
    <xacro:if value="${taxels == 1}">
      <xacro:taxel sequence="${sequence}_4x4_1"  x="${1*0.0046666+0.0007}" y="${4*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
      <xacro:taxel sequence="${sequence}_4x4_2"  x="${2*0.0046666+0.0007}" y="${4*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
      <xacro:taxel sequence="${sequence}_4x4_3"  x="${3*0.0046666+0.0007}" y="${4*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
      <xacro:taxel sequence="${sequence}_4x4_4"  x="${4*0.0046666+0.0007}" y="${4*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
      <xacro:taxel sequence="${sequence}_4x4_5"  x="${1*0.0046666+0.0007}" y="${3*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
      <xacro:taxel sequence="${sequence}_4x4_6"  x="${2*0.0046666+0.0007}" y="${3*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
      <xacro:taxel sequence="${sequence}_4x4_7"  x="${3*0.0046666+0.0007}" y="${3*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
      <xacro:taxel sequence="${sequence}_4x4_8"  x="${4*0.0046666+0.0007}" y="${3*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
      <xacro:taxel sequence="${sequence}_4x4_9"  x="${1*0.0046666+0.0007}" y="${2*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
      <xacro:taxel sequence="${sequence}_4x4_10" x="${2*0.0046666+0.0007}" y="${2*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
      <xacro:taxel sequence="${sequence}_4x4_11" x="${3*0.0046666+0.0007}" y="${2*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
      <xacro:taxel sequence="${sequence}_4x4_12" x="${4*0.0046666+0.0007}" y="${2*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
      <xacro:taxel sequence="${sequence}_4x4_13" x="${1*0.0046666+0.0007}" y="${1*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
      <xacro:taxel sequence="${sequence}_4x4_14" x="${2*0.0046666+0.0007}" y="${1*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
      <xacro:taxel sequence="${sequence}_4x4_15" x="${3*0.0046666+0.0007}" y="${1*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
      <xacro:taxel sequence="${sequence}_4x4_16" x="${4*0.0046666+0.0007}" y="${1*0.00466666+0.00015}" z="0.004" parent="${sequence}_4x4_base_link" />
    </xacro:if>
  </xacro:macro>
  <xacro:macro name="sensor1x6" params="sequence parent x:=0.0 y:=0.0 z:=0.0 rx:=0.0 ry:=0.0 rz:=0.0 col:='blue' body:=1 taxels:=1 skipinertia:=0">
    <joint name="${sequence}_1x6_fixed" type="fixed">
      <origin xyz="${x} ${y} ${z}" rpy="${radians(rx)} ${radians(ry)} ${radians(rz)}"/>
      <parent link="${parent}" />
      <child link="${sequence}_1x6_base_link" />
    </joint>
    <link name="${sequence}_1x6_base_link">
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://xela_models/mesh/1x6.stl"/>
        </geometry>
      </collision>
      <xacro:if value="${body == 1}">
        <visual>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <geometry>
            <mesh filename="package://xela_models/mesh/1x6.stl"/>
          </geometry>
          <material name="${col}"/>
        </visual>
        <xacro:unless value="${skipinertia == 1}">
          <inertial>
            <mass value="0.0018" />
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <inertia ixx="9.47e-10" ixy="0.0" ixz="0.0" iyy="4.68e-11" iyz="0.0" izz="9.50e-10" />
          </inertial>
        </xacro:unless>
      </xacro:if>
    </link>
    <xacro:if value="${taxels == 1}">
      <xacro:taxel sequence="${sequence}_1x6_1" x="${1*0.0046666-0.0023}" y="${6*0.00466666-0.0023}" z="0.005" parent="${sequence}_1x6_base_link" />
      <xacro:taxel sequence="${sequence}_1x6_2" x="${1*0.0046666-0.0023}" y="${5*0.00466666-0.0023}" z="0.005" parent="${sequence}_1x6_base_link" />
      <xacro:taxel sequence="${sequence}_1x6_3" x="${1*0.0046666-0.0023}" y="${4*0.00466666-0.0023}" z="0.005" parent="${sequence}_1x6_base_link" />
      <xacro:taxel sequence="${sequence}_1x6_4" x="${1*0.0046666-0.0023}" y="${3*0.00466666-0.0023}" z="0.005" parent="${sequence}_1x6_base_link" />
      <xacro:taxel sequence="${sequence}_1x6_5" x="${1*0.0046666-0.0023}" y="${2*0.00466666-0.0023}" z="0.005" parent="${sequence}_1x6_base_link" />
      <xacro:taxel sequence="${sequence}_1x6_6" x="${1*0.0046666-0.0023}" y="${1*0.00466666-0.0023}" z="0.005" parent="${sequence}_1x6_base_link" />
    </xacro:if>
  </xacro:macro>
  <xacro:macro name="sensor4x6" params="sequence parent x:=0.0 y:=0.0 z:=0.0 rx:=0.0 ry:=0.0 rz:=0.0 col:='blue' body:=1 taxels:=1 skipinertia:=0">
    <joint name="${sequence}_4x6_fixed" type="fixed">
      <origin xyz="${x} ${y} ${z}" rpy="${radians(rx)} ${radians(ry)} ${radians(rz)}"/>
      <parent link="${parent}" />
      <child link="${sequence}_4x6_base_link" />
    </joint>
    <link name="${sequence}_4x6_base_link">
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://xela_models/mesh/4x6.stl"/>
        </geometry>
      </collision>
      <xacro:if value="${body == 1}">
        <visual>
          <origin xyz="0 0 0" rpy="0 0 0" />
          <geometry>
            <mesh filename="package://xela_models/mesh/4x6.stl"/>
          </geometry>
          <material name="${col}"/>
        </visual>
        <xacro:unless value="${skipinertia == 1}">
          <inertial>
            <mass value="0.0108" />
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <inertia ixx="1.11e-07" ixy="0.0" ixz="0.0" iyy="2.97e-07" iyz="0.0" izz="4.03e-07" />
          </inertial>
        </xacro:unless>
      </xacro:if>
    </link>
    <xacro:if value="${taxels == 1}">
      <xacro:taxel sequence="${sequence}_4x6_1"  x="${1*0.00724+0.0030}" y="${4*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_2"  x="${2*0.00724+0.0030}" y="${4*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_3"  x="${3*0.00724+0.0030}" y="${4*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_4"  x="${4*0.00724+0.0030}" y="${4*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_5"  x="${5*0.00724+0.0030}" y="${4*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_6"  x="${6*0.00724+0.0030}" y="${4*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_7"  x="${1*0.00724+0.0030}" y="${3*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_8"  x="${2*0.00724+0.0030}" y="${3*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_9"  x="${3*0.00724+0.0030}" y="${3*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_10" x="${4*0.00724+0.0030}" y="${3*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_11" x="${5*0.00724+0.0030}" y="${3*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_12" x="${6*0.00724+0.0030}" y="${3*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_13" x="${1*0.00724+0.0030}" y="${2*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_14" x="${2*0.00724+0.0030}" y="${2*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_15" x="${3*0.00724+0.0030}" y="${2*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_16" x="${4*0.00724+0.0030}" y="${2*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_17" x="${5*0.00724+0.0030}" y="${2*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_18" x="${6*0.00724+0.0030}" y="${2*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_19" x="${1*0.00724+0.0030}" y="${1*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_20" x="${2*0.00724+0.0030}" y="${1*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_21" x="${3*0.00724+0.0030}" y="${1*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_22" x="${4*0.00724+0.0030}" y="${1*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_23" x="${5*0.00724+0.0030}" y="${1*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
      <xacro:taxel sequence="${sequence}_4x6_24" x="${6*0.00724+0.0030}" y="${1*0.00717-0.002175}" z="0.005" parent="${sequence}_4x6_base_link" />
    </xacro:if>
  </xacro:macro>

  <!-- Allegro Hands -->
  <xacro:macro name="allegro_hand_right" params="sequence parent x:=0.0 y:=0.0 z:=0.0 rx:=0.0 ry:=0.0 rz:=0.0 covers:=1 phalanges:=1 tips:='flat' palm:=1 taxels:=0 defaultnames:=0">
    <xacro:if value="${sequence == ''}">
      <xacro:property name="seq" value=""/>
    </xacro:if>
    <xacro:unless value="${sequence == ''}">
      <xacro:property name="seq" value="${sequence}_"/>
    </xacro:unless>
    <link name="${seq}base_link">
      <visual>
        <geometry>
          <xacro:if value="${palm == 1}">
            <mesh filename="package://xela_models/mesh/allegro/base.stl" />
          </xacro:if>
          <xacro:if value="${palm != 1}">
            <mesh filename="package://xela_models/mesh/allegro/base_ns.stl"/>   
          </xacro:if>
        </geometry>
        <origin rpy="0 0 0" xyz="0 0 0 "/>
        <material name="cyan">
          <color rgba="0.0 1.0 1.0 1"/>
        </material>
      </visual>
      <collision>
        <origin rpy="0 0 0" xyz="-0.009300 0 -${0.095/2}"/>
        <geometry>
          <box size="0.0408 0.1130 ${0.095}"/>
        </geometry>
      </collision>
      <xacro:if value="${palm == 1}">
        <inertial>
          <mass value="0.4288" />
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <inertia ixx="2.04e-03" ixy="8.58e-06" ixz="8.58e-06" iyy="1.23e-03" iyz="0.0" izz="1.25e-03" />
        </inertial>
      </xacro:if>
      <xacro:if value="${palm != 1}">
        <inertial>
          <mass value="0.4154" />
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <inertia ixx="1.87e-03" ixy="0.0" ixz="8.31e-06" iyy="1.13e-03" iyz="0.0" izz="1.11e-03" />
        </inertial>
      </xacro:if>
    </link>
    <joint name="${seq}ahr_fixed" type="fixed">
        <origin xyz="${x} ${y} ${z}" rpy="${radians(rx)} ${radians(ry)} ${radians(rz)}"/>
        <parent link="${parent}" />
        <child link="${seq}base_link" />
      </joint>
    <xacro:if value="${palm == 1}">
      <xacro:sensor4x6 sequence="${seq}ahr_palm_1" col="red" parent="${seq}base_link" x="0.013" y="-0.051" z="-0.0365"  rz="90" rx="90" ry="0.0" taxels="${taxels}" skipinertia="1" />
      <xacro:sensor4x6 sequence="${seq}ahr_palm_2" col="green" parent="${seq}base_link" x="0.013" y="0.0523" z="-0.005"  rz="90" rx="90" ry="180.0" taxels="${taxels}" skipinertia="1" />
      <xacro:sensor4x6 sequence="${seq}ahr_palm_3" col="blue" parent="${seq}base_link" x="0.013" y="-0.051" z="-0.068" rz="90" rx="90" ry="0.0" taxels="${taxels}" skipinertia="1" />
    </xacro:if>
    <xacro:if value="${defaultnames == 1}">
    <xacro:finger 
      sequence=			    "${seq}"
      parent=				    "${seq}base_link"
      finger_num=			  "0"
      offset_origin_x=	"${0}"	
      offset_origin_y=	"${0.0435}"
      offset_origin_z=	"${-0.001542}"
      finger_angle_r=		"-${radians(5.0)}"
      covers=				    "${covers}"
      phalanges=				"${phalanges}"
      tip=				      "${tips}"
      taxels=           "${taxels}"
    />
    <xacro:finger
      sequence=			    "${seq}"
      parent=				    "${seq}base_link"
      finger_num=			  "1" 
      offset_origin_x=	"${0}"	
      offset_origin_y=	"0" 
      offset_origin_z=	"${0.0007}" 
      finger_angle_r=		"0.0"
      covers=				    "${covers}"
      phalanges=				"${phalanges}"
      tip=				      "${tips}"
      taxels=           "${taxels}"
    />
    <xacro:finger 
      sequence=			    "${seq}"
      parent=				    "${seq}base_link"
      finger_num=			  "2" 
      offset_origin_x=	"${0}"	
      offset_origin_y=	"-${0.0435}" 
      offset_origin_z=	"${-0.001542}" 
      finger_angle_r=		"${radians(5.0)}"
      covers=				    "${covers}"
      phalanges=				"${phalanges}"
      tip=				      "${tips}"
      taxels=           "${taxels}"
    />
    <xacro:thumb_right
      sequence=			    "${seq}"
      parent=				    "${seq}base_link"
      finger_num=			  "3" 
      offset_origin_x=	"-0.0182"	
      offset_origin_y=	"0.019333" 
      offset_origin_z=	"-0.045987"
      covers=				    "${covers}"
      finger_angle_r=		"0"
      finger_angle_p=		"-${radians(95)}"	
      finger_angle_y=		"-${radians(90)}"
      phalanges=				"${phalanges}"
      tip=				      "${tips}"
      taxels=           "${taxels}"
    />
    </xacro:if>
    <xacro:unless value="${defaultnames == 1}">
      <xacro:finger 
        sequence=			    "${seq}hitosashi_finger_"
        parent=				    "${seq}base_link"
        finger_num=			  "0"
        offset_origin_x=	"${0}"	
        offset_origin_y=	"${0.0435}"
        offset_origin_z=	"${-0.001542}"
        finger_angle_r=		"-${radians(5.0)}"
        covers=				    "${covers}"
        phalanges=				"${phalanges}"
        tip=				      "${tips}"
        taxels=           "${taxels}"
      />
      <xacro:finger
        sequence=			    "${seq}naka_finger_"
        parent=				    "${seq}base_link"
        finger_num=			  "1" 
        offset_origin_x=	"${0}"	
        offset_origin_y=	"0" 
        offset_origin_z=	"${0.0007}" 
        finger_angle_r=		"0.0"
        covers=				    "${covers}"
        phalanges=				"${phalanges}"
        tip=				      "${tips}"
        taxels=           "${taxels}"
      />
      <xacro:finger 
        sequence=			    "${seq}kusuri_finger_"
        parent=				    "${seq}base_link"
        finger_num=			  "2" 
        offset_origin_x=	"${0}"	
        offset_origin_y=	"-${0.0435}" 
        offset_origin_z=	"${-0.001542}" 
        finger_angle_r=		"${radians(5.0)}"
        covers=				    "${covers}"
        phalanges=				"${phalanges}"
        tip=				      "${tips}"
        taxels=           "${taxels}"
      />
      <xacro:thumb_right
        sequence=			    "${seq}oya_finger_"
        parent=				    "${seq}base_link"
        finger_num=			  "3" 
        offset_origin_x=	"-0.0182"	
        offset_origin_y=	"0.019333" 
        offset_origin_z=	"-0.045987"
        covers=				    "${covers}"
        finger_angle_r=		"0"
        finger_angle_p=		"-${radians(95)}"	
        finger_angle_y=		"-${radians(90)}"
        phalanges=				"${phalanges}"
        tip=				      "${tips}"
        taxels=           "${taxels}"
      />
    </xacro:unless>
    </xacro:macro>
    <!--FINGER MACRO-->
    <xacro:macro name="finger" params="sequence parent finger_num offset_origin_x offset_origin_y offset_origin_z finger_angle_r covers:=1 tip:='flat' phalanges:=1 taxels:=0">
      <link name="${sequence}finger_link_${finger_num*4+0}">	
        <visual>
          <geometry>
            <mesh filename="package://xela_models/mesh/allegro/link_0.0_ext.STL" />
          </geometry>
          <material name="grey"/>
        </visual>
        <collision>
          <geometry>
            <box size="${0.0196} ${0.0275} ${0.0164}"/>
          </geometry>
          <origin rpy="0 0 0" xyz="0 0 ${0.0164/2+0.003}"/>
        </collision>
        <inertial>
          <mass value="0.0127" />
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <inertia ixx="1.38e-07" ixy="1.27e-10" ixz="4.83e-09" iyy="6.83e-08" iyz="0.0" izz="1.16e-07" />
        </inertial>
      </link>
      <joint name="${sequence}finger_joint_${finger_num*4+0}" type="revolute">
        <axis xyz="0 0 1"/>
        <limit effort="15" velocity="7" lower="${-0.57+0.1}" upper="${0.57-0.1}" />
        <parent link="${parent}"/>
        <child link="${sequence}finger_link_${finger_num*4+0}"/>
        <origin rpy="${finger_angle_r} 0 0" xyz="${offset_origin_x} ${offset_origin_y} ${offset_origin_z}"/>
      </joint>
      <link name="${sequence}finger_link_${finger_num*4+1}">	
        <visual>
          <geometry>
            <xacro:if value="${phalanges == 1}">
              <mesh filename="package://xela_models/mesh/allegro/link_1.1.stl" />
            </xacro:if>
            <xacro:if value="${phalanges != 1}">
              <mesh filename="package://xela_models/mesh/allegro/link_1_ns.stl"/>   
            </xacro:if>
          </geometry>
          <material name="black" />
        </visual>
        <collision>
          <geometry>
            <box size="${0.0196} ${0.0275} ${0.0164}"/>
          </geometry>
          <origin rpy="0 0 0" xyz="0 0 ${0.0164/2}"/>
        </collision>
        <xacro:if value="${covers == 1}">
          <inertial>
            <mass value="0.0809" />
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <inertia ixx="1.75e-05" ixy="0.0" ixz="5.66e-08" iyy="1.80e-05" iyz="0.0" izz="4.60e-06" />
          </inertial>
        </xacro:if>
        <xacro:unless value="${covers == 1}">
          <xacro:if value="${phalanges == 1}">
            <inertial>
              <mass value="0.0719" />
              <origin xyz="0 0 0" rpy="0 0 0"/>
              <inertia ixx="1.56e-05" ixy="0.0" ixz="5.03e-08" iyy="1.60e-05" iyz="0.0" izz="4.09e-06" />
            </inertial>
          </xacro:if>
          <xacro:unless value="${phalanges == 1}">
            <inertial>
              <mass value="0.0650" />
              <origin xyz="0 0 0" rpy="0 0 0"/>
              <inertia ixx="1.14e-05" ixy="0.0" ixz="0.0" iyy="1.12e-05" iyz="0.0" izz="2.56e-06" />
            </inertial>
          </xacro:unless>
        </xacro:unless>
      </link>
      <xacro:if value="${covers == 1}"><!--covers are always with sensors-->
        <link name="${sequence}finger_link_${finger_num*4+1}_cover">	
          <visual>
            <geometry>
              <mesh filename="package://xela_models/mesh/allegro/link_1_cover.stl" />
            </geometry>
            <material name="red"/>
          </visual>
          <collision>
            <geometry>
              <mesh filename="package://xela_models/mesh/allegro/link_1_cover.stl" />
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 ${0.0177/2}"/>
          </collision>
          <!--As link is fixed, inertias will be inside the main link-->
        </link>
        <joint name="${sequence}finger_link_${finger_num*4+1}_cover_joint" type="fixed">
          <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
          <parent link="${sequence}finger_link_${finger_num*4+1}" />
          <child link="${sequence}finger_link_${finger_num*4+1}_cover" />
        </joint>
      </xacro:if>
      <xacro:if value="${phalanges == 1 and taxels == 1}">
        <xacro:sensor4x4 sequence="${sequence}finger_link_${finger_num*4+1}A" col="red" parent="${sequence}finger_link_${finger_num*4+1}" ry="-90" rz="180" z="0.033" y="0.012" x="0.0108" body="0" taxels="${taxels}" skipinertia="1" />
        <xacro:sensor4x4 sequence="${sequence}finger_link_${finger_num*4+1}B" col="red" parent="${sequence}finger_link_${finger_num*4+1}" ry="90" z="0.021" y="-0.012" x="0.0108" body="0" taxels="${taxels}" skipinertia="1" />
      </xacro:if>
      <joint name="${sequence}finger_joint_${finger_num*4+1}" type="revolute">
        <limit effort="15" velocity="7" lower="${-0.296+0.1}" upper="${1.71-0.1}" />
        <axis xyz="0 1 0"/>
        <parent link="${sequence}finger_link_${finger_num*4+0}"/>
        <child link="${sequence}finger_link_${finger_num*4+1}"/>
        <origin xyz="0 0 ${0.0164+0.004}"/><!-- New height on fingers -->
      </joint>
      <link name="${sequence}finger_link_${finger_num*4+2}">	
        <visual>
          <geometry>
            <xacro:if value="${phalanges == 1}">
              <mesh filename="package://xela_models/mesh/allegro/link_2.1.stl" />
            </xacro:if>
            <xacro:if value="${phalanges != 1}">
              <mesh filename="package://xela_models/mesh/allegro/link_2_ns.stl"/>   
            </xacro:if>
          </geometry>
          <material name="black" />
        </visual>
        <collision>
          <geometry>
            <box size="${0.0196} ${0.0275} ${0.0540}"/>
          </geometry>
          <origin rpy="0 0 0" xyz="0 0 ${0.0540/2}"/>     
        </collision>
        <xacro:if value="${covers == 1}"><!--covers are always with sensors-->
          <inertial>
            <mass value="0.0447" />
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <inertia ixx="3.80e-07" ixy="0.0" ixz="7.15e-09" iyy="2.26e-07" iyz="1.34e-09" izz="1.86e-07" />
          </inertial>
        </xacro:if>
        <xacro:unless value="${covers == 1}">
          <xacro:if value="${phalanges == 1}">
            <inertial>
              <mass value="0.0422" />
              <origin xyz="0 0 0" rpy="0 0 0"/>
              <inertia ixx="3.15e-06" ixy="0.0" ixz="0.0" iyy="3.05e-06" iyz="0.0" izz="1.33e-06" />
            </inertial>
          </xacro:if>
          <xacro:unless value="${phalanges == 1}">
            <inertial>
              <mass value="0.0355" />
              <origin xyz="0 0 0" rpy="0 0 0"/>
              <inertia ixx="2.46e-06" ixy="0.0" ixz="0.0" iyy="2.26e-06" iyz="0.0" izz="8.95e-07" />
            </inertial>
          </xacro:unless>
        </xacro:unless>
      </link>
      <xacro:if value="${covers == 1}">
        <link name="${sequence}finger_link_${finger_num*4+2}_cover">	
          <visual>
            <geometry>
              <mesh filename="package://xela_models/mesh/allegro/link_2_cover.stl" />
            </geometry>
            <material name="red"/>
          </visual>
          <collision>
            <geometry>
              <mesh filename="package://xela_models/mesh/allegro/link_2_cover.stl" />
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 ${0.0514/2}"/>
          </collision>
        </link>
        <joint name="${sequence}finger_link_${finger_num*4+2}_cover_joint" type="fixed">
          <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
          <parent link="${sequence}finger_link_${finger_num*4+2}" />
          <child link="${sequence}finger_link_${finger_num*4+2}_cover" />
        </joint>
      </xacro:if>
      <xacro:if value="${phalanges == 1 and taxels == 1}">
        <xacro:sensor4x4 sequence="${sequence}finger_link_${finger_num*4+2}" col="red" parent="${sequence}finger_link_${finger_num*4+2}" ry="90" z="0.0445" y="-0.012" x="0.01" body="0" skipinertia="1" />
      </xacro:if>
      <joint name="${sequence}finger_joint_${finger_num*4+2}" type="revolute">
        <axis xyz="0 1 0"/>
        <limit effort="15" velocity="7" lower="${-0.274+0.1}" upper="${1.809-0.1}" />
        <parent link="${sequence}finger_link_${finger_num*4+1}"/>
        <child link="${sequence}finger_link_${finger_num*4+2}"/>
        <origin xyz="0 0 ${0.0540}"/>
      </joint>
      <link name="${sequence}finger_link_${finger_num*4+3}">	
        <visual>
          <geometry>
            <mesh filename="package://xela_models/mesh/allegro/link_3.0.STL" />
          </geometry>
          <material name="black" />
        </visual>
        <collision>
          <geometry>
            <box size="${0.0196} ${0.0275} ${0.0384-0.0120}"/>
          </geometry>
          <origin rpy="0 0 0" xyz="0 0 ${(0.0384-0.0120)/2}"/>
        </collision>
        <xacro:if value="${tip == 'flat'}">
          <inertial>
            <mass value="0.0281" />
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <inertia ixx="1.59e-06" ixy="0.0" ixz="0.0" iyy="1.49e-06" iyz="0.0" izz="1.10e-06" />
          </inertial>
        </xacro:if>
        <xacro:if value="${tip == 'curved'}">
          <inertial>
            <mass value="0.0404" />
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <inertia ixx="3.64e-06" ixy="0.0" ixz="0.0" iyy="3.33e-06" iyz="0.0" izz="1.92e-06" />
          </inertial>
        </xacro:if>
        <xacro:unless value="${tip == 'flat' or tip == 'curved'}">
          <inertial>
            <mass value="0.0280" />
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <inertia ixx="3.05e-07" ixy="0.0" ixz="0.0" iyy="1.51e-07" iyz="0.0" izz="2.56e-07" />
          </inertial>
        </xacro:unless>
      </link>
      <joint name="${sequence}finger_joint_${finger_num*4+3}" type="revolute">
        <axis xyz="0 1 0"/>
        <limit effort="15" velocity="7" lower="${-0.327+0.1}" upper="${1.718-0.1}" />
        <parent link="${sequence}finger_link_${finger_num*4+2}"/>
        <child link="${sequence}finger_link_${finger_num*4+3}"/>
        <origin xyz="0 0.0 0.0384"/>
      </joint>
    <xacro:if value="${tip == 'flat'}">
      <xacro:sensoraftf sequence="${sequence}finger_${finger_num}" col="red" parent="${sequence}finger_link_${finger_num*4+3}" rx="90" rz="90" z="0.016" taxels="${taxels}" skipinertia="1"/>
    </xacro:if>
    <xacro:if value="${tip == 'curved'}">
      <xacro:sensoraftc sequence="${sequence}finger_${finger_num}" col="red" parent="${sequence}finger_link_${finger_num*4+3}" rx="90" rz="90" z="0.016" taxels="${taxels}" skipinertia="1"/>
    </xacro:if>
    <xacro:if value="${tip == 'default'}">
      <xacro:aftd sequence="${sequence}finger_${finger_num}" col="white" parent="${sequence}finger_link_${finger_num*4+3}" rx="0" rz="0" z="0.027" x="0.013" skipinertia="1"/>
    </xacro:if>
    </xacro:macro>

    <!--THUMB MACRO-->
    <xacro:macro name="thumb_right" params="sequence parent finger_num offset_origin_x offset_origin_y offset_origin_z finger_angle_r finger_angle_p finger_angle_y covers:=1 phalanges:=1 tip:='flat' taxels:=0">
      <link name="${sequence}_link_${finger_num*4+0}">
        <visual>
          <geometry>
            <mesh filename="package://xela_models/mesh/allegro/link_12.0_right.STL" />
          </geometry>
          <material name="grey" />
        </visual>
        <collision>
          <geometry>
            <box size="${0.0358} ${0.0340} ${0.0455}"/>
          </geometry>
          <origin rpy="0 0 0" xyz="${-0.0358/2+0.0} ${.018/2} ${.029/2}"/>
        </collision>
        <inertial>
          <mass value="0.0176" />
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <inertia ixx="3.36e-06" ixy="0.0" ixz="1.76e-08" iyy="3.84e-06" iyz="2.46e-07" izz="2.59e-06" />
        </inertial>
      </link>
      <joint name="${sequence}_joint_${finger_num*4+0}" type="revolute">
        <axis xyz="-1 0 0"/>
        <limit effort="15" velocity="7" lower="${0.363-0.1}" upper="${1.496-0.1}" />
        <parent link="${parent}"/>
        <child link="${sequence}_link_${finger_num*4+0}"/>
        <origin rpy="${finger_angle_r} ${finger_angle_p} ${finger_angle_y}" xyz="${offset_origin_x} ${offset_origin_y} ${offset_origin_z}"/>
      </joint>
      <link name="${sequence}_link_${finger_num*4+1}">	
        <visual>
          <geometry>
            <mesh filename="package://xela_models/mesh/allegro/link_13.0.STL" />
          </geometry>
          <material name="grey" />
        </visual>
        <collision>
          <geometry>
            <box size="${0.0196} ${0.0275} ${0.0177}"/>
          </geometry>
          <origin rpy="0 0 0" xyz="0 0 ${0.0177/2}"/>
        </collision>
        <inertial>
          <mass value="0.0127" />
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <inertia ixx="1.38e-07" ixy="1.27e-10" ixz="4.83e-09" iyy="6.83e-08" iyz="0.0" izz="1.16e-07" />
        </inertial>
      </link>
      <xacro:if value="${covers == 1}">
        <link name="${sequence}_link_${finger_num*4+2}_cover">	
          <visual>
            <geometry>
              <mesh filename="package://xela_models/mesh/allegro/thumb_1_cover.stl" />
            </geometry>
            <material name="red"/>
          </visual>
          <collision>
            <geometry>
              <mesh filename="package://xela_models/mesh/allegro/thumb_1_cover.stl" />
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 0"/>
          </collision>
        </link>
        <joint name="${sequence}_link_${finger_num*4+2}_cover_joint" type="fixed">
          <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
          <parent link="${sequence}_link_${finger_num*4+2}" />
          <child link="${sequence}_link_${finger_num*4+2}_cover" />
        </joint>
      </xacro:if>
      <joint name="${sequence}_joint_${finger_num*4+1}" type="revolute">
        <axis xyz="0 0 1"/>
        <limit effort="15" velocity="7" lower="${-0.205+0.1}" upper="${1.263-0.1}" />
        <parent link="${sequence}_link_${finger_num*4+0}"/>
        <child link="${sequence}_link_${finger_num*4+1}"/>   
        <origin xyz="-0.027 0.005 0.0399"/>
      </joint>
      <link name="${sequence}_link_${finger_num*4+2}">	
        <visual>
          <geometry>
            <xacro:if value="${phalanges == 1}">
              <mesh filename="package://xela_models/mesh/allegro/thumb_1.1.stl"/>   
            </xacro:if>
            <xacro:if value="${phalanges != 1}">
              <mesh filename="package://xela_models/mesh/allegro/thumb_1.1_ns.stl"/>   
            </xacro:if>
          </geometry>
          <material name="black" />
        </visual>
        <collision>
          <geometry>
            <box size="${0.0196} ${0.0275} ${0.0514}"/>
          </geometry>
          <origin rpy="0 0 0" xyz="0 0 ${0.0514/2}"/>
        </collision>
        <xacro:if value="${covers == 1}"><!--covers are always with sensors-->
          <inertial>
            <mass value="0.0457" />
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <inertia ixx="3.20e-06" ixy="9.14e-09" ixz="1.46e-07" iyy="3.03e-06" iyz="0.0" izz="1.47e-06" />
          </inertial>
        </xacro:if>
        <xacro:unless value="${covers == 1}">
          <xacro:if value="${phalanges == 1}">
            <inertial>
              <mass value="0.0435" />
              <origin xyz="0 0 0" rpy="0 0 0"/>
              <inertia ixx="3.05e-06" ixy="8.70e-09" ixz="1.39e-07" iyy="2.88e-06" iyz="0.0" izz="1.40e-06" />
            </inertial>
          </xacro:if>
          <xacro:unless value="${phalanges == 1}">
            <inertial>
              <mass value="0.0380" />
              <origin xyz="0 0 0" rpy="0 0 0"/>
              <inertia ixx="2.47e-06" ixy="0.0" ixz="2.66e-08" iyy="2.17e-06" iyz="3.80e-09" izz="9.20e-07" />
            </inertial>
          </xacro:unless>
        </xacro:unless>
      </link>
      <xacro:if value="${covers == 1}">
        <link name="${sequence}_link_${finger_num*4+3}_cover">	
          <visual>
            <geometry>
              <mesh filename="package://xela_models/mesh/allegro/thumb_2_cover.stl" />
            </geometry>
            <material name="red"/>
          </visual>
          <collision>
            <geometry>
              <mesh filename="package://xela_models/mesh/allegro/thumb_2_cover.stl" />
            </geometry>
            <origin rpy="0 0 0" xyz="0 0 0"/>
          </collision>
        </link>
        <joint name="${sequence}_link_${finger_num*4+3}_cover_joint" type="fixed">
          <origin xyz="0.0 0.0 0.0" rpy="0.0 0.0 0.0"/>
          <parent link="${sequence}_link_${finger_num*4+3}" />
          <child link="${sequence}_link_${finger_num*4+3}_cover" />
        </joint>
      </xacro:if>
      <xacro:if value="${phalanges == 1 and taxels == 1}">
        <xacro:sensor4x4 sequence="${sequence}_link_${finger_num*4+2}" parent="${sequence}_link_${finger_num*4+2}" ry="90" z="0.023" y="-0.012" x="0.011" body="0" skipinertia="1" />
      </xacro:if>
      <joint name="${sequence}_joint_${finger_num*4+2}" type="revolute">
        <axis xyz="0 1 0"/>
        <limit effort="15" velocity="7" lower="${-0.289+0.1}" upper="${1.744-0.1}" />
        <parent link="${sequence}_link_${finger_num*4+1}"/>
        <child link="${sequence}_link_${finger_num*4+2}"/>
        <origin xyz="0 0 ${0.0177}"/>
      </joint> 
      <link name="${sequence}_link_${finger_num*4+3}">
        <visual>
          <geometry>
            <xacro:if value="${phalanges == 1}">
              <mesh filename="package://xela_models/mesh/allegro/thumb_2.1.stl"/>  
            </xacro:if>
            <xacro:if value="${phalanges != 1}">
              <mesh filename="package://xela_models/mesh/allegro/thumb_1.2_ns.stl"/>   
            </xacro:if> 
          </geometry>
        <material name="black" />
        </visual>
        <collision>
          <geometry>
            <box size="${0.0196} ${0.0275} ${0.0543-0.0120}"/>
          </geometry>
          <origin rpy="0 0 0" xyz="0 0 ${(0.0543-0.0120)/2}"/>
        </collision><!--6 options-->
        <xacro:if value="${covers == 1}"><!--covers are always with phalange sensors-->
          <xacro:if value="${tips == 'curved'}">
            <inertial>
              <mass value="0.0753" />
              <origin xyz="0 0 0" rpy="0 0 0"/>
              <inertia ixx="2.90e-05" ixy="0.0" ixz="0.0" iyy="2.90e-05" iyz="0.0" izz="6.88e-06" />
            </inertial>
          </xacro:if>
          <xacro:if value="${tips == 'flat'}">
            <inertial>
              <mass value="0.0629" />
              <origin xyz="0 0 0" rpy="0 0 0"/>
              <inertia ixx="1.73e-05" ixy="0.0" ixz="0.0" iyy="1.77e-05" iyz="0.0" izz="5.47e-06" />
            </inertial>
          </xacro:if>
          <xacro:unless value="${tips == 'flat' or tips == 'curved'}">
            <inertial>
              <mass value="0.0645" />
              <origin xyz="0 0 0" rpy="0 0 0"/>
              <inertia ixx="1.20e-05" ixy="0.0" ixz="0.0" iyy="1.22e-05" iyz="0.0" izz="4.03e-06" />
            </inertial>
          </xacro:unless>
        </xacro:if>
        <xacro:unless value="${covers == 1}">
          <xacro:if value="${phalanges == 1}">
            <xacro:if value="${tips == 'curved'}">
              <inertial>
                <mass value="0.0731" />
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <inertia ixx="2.82e-05" ixy="0.0" ixz="0.0" iyy="2.82e-05" iyz="0.0" izz="6.68e-06" />
              </inertial>
            </xacro:if>
            <xacro:if value="${tips == 'flat'}">
              <inertial>
                <mass value="0.0607" />
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <inertia ixx="1.67e-05" ixy="0.0" ixz="0.0" iyy="1.71e-05" iyz="0.0" izz="5.27e-06" />
              </inertial>
            </xacro:if>
            <xacro:unless value="${tips == 'flat' or tips == 'curved'}">
              <inertial>
                <mass value="0.0623" />
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <inertia ixx="1.16e-05" ixy="0.0" ixz="0.0" iyy="1.17e-05" iyz="0.0" izz="3.89e-06" />
              </inertial>
            </xacro:unless>
          </xacro:if>
          <xacro:unless value="${phalanges == 1}">
            <xacro:if value="${tips == 'curved'}">
              <inertial>
                <mass value="0.0674" />
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <inertia ixx="2.43e-05" ixy="0.0" ixz="0.0" iyy="2.39e-05" iyz="0.0" izz="5.37e-06" />
              </inertial>
            </xacro:if>
            <xacro:if value="${tips == 'flat'}">
              <inertial>
                <mass value="0.0550" />
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <inertia ixx="1.42e-05" ixy="0.0" ixz="0.0" iyy="1.44e-05" iyz="0.0" izz="4.30e-06" />
              </inertial>
            </xacro:if>
            <xacro:unless value="${tips == 'flat' or tips == 'curved'}">
              <inertial>
                <mass value="0.0576" />
                <origin xyz="0 0 0" rpy="0 0 0"/>
                <inertia ixx="1.01e-05" ixy="0.0" ixz="0.0" iyy="9.84e-06" iyz="0.0" izz="2.91e-06" />
              </inertial>
            </xacro:unless>
          </xacro:unless>
        </xacro:unless>
      </link>
      <xacro:if value="${phalanges == 1 and taxels == 1}">
        <xacro:sensor4x4 sequence="${sequence}_link_${finger_num*4+3}" parent="${sequence}_link_${finger_num*4+3}" ry="90" z="0.021" y="-0.012" x="0.011" body="0" skipinertia="1" />
      </xacro:if>
    <joint name="${sequence}_joint_${finger_num*4+3}" type="revolute">
      <axis xyz="0 1 0"/>
      <limit effort="15" velocity="7" lower="${-0.262+0.1}" upper="${1.819-0.1}" />
      <parent link="${sequence}_link_${finger_num*4+2}"/>
      <child link="${sequence}_link_${finger_num*4+3}"/>
      <origin xyz="0 0 ${0.0514}"/>
    </joint>
    <xacro:if value="${tip == 'flat'}">
      <xacro:sensoraftf sequence="${sequence}_${finger_num}" col="green" parent="${sequence}_link_${finger_num*4+3}" rx="90" rz="90" z="0.0315" taxels="${taxels}" skipinertia="1" />
    </xacro:if>
    <xacro:if value="${tip == 'curved'}">
      <xacro:sensoraftc sequence="${sequence}_${finger_num}" col="green" parent="${sequence}_link_${finger_num*4+3}" rx="90" rz="90" z="0.0315" taxels="${taxels}" skipinertia="1" />
    </xacro:if>
    <xacro:if value="${tip == 'default'}">
      <xacro:aftd sequence="${sequence}_${finger_num}" col="white" parent="${sequence}_link_${finger_num*4+3}" rx="0" rz="0" z="0.042" x="0.013" skipinertia="1" />
    </xacro:if>
  </xacro:macro>
</robot>
